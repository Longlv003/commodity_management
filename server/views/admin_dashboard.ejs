<!DOCTYPE html>
<html class="dark" lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Dashboard - Admin</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
          "Segoe UI", sans-serif;
      }
      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
        background-color: rgba(148, 163, 184, 0.8);
        border-radius: 9999px;
      }
      .dashboard-card {
        transition: all 0.3s ease;
      }
      .dashboard-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
      }
    </style>
  </head>

  <body class="bg-slate-950 text-slate-100">
    <div class="flex min-h-screen">
      <!-- Mobile menu button -->
      <button
        id="mobileMenuBtn"
        class="md:hidden fixed top-4 left-4 z-30 p-2 rounded-lg bg-slate-800 text-slate-100 hover:bg-slate-700"
      >
        <span class="material-symbols-outlined text-xl">menu</span>
      </button>

      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="hidden md:flex w-64 flex-col border-r border-slate-800 bg-slate-950/80 backdrop-blur fixed left-0 top-0 h-screen z-20 overflow-y-auto"
      >
        <!-- Close button for mobile -->
        <button
          id="closeSidebarBtn"
          class="md:hidden absolute top-4 right-4 p-2 rounded-lg bg-slate-800 text-slate-100 hover:bg-slate-700"
        >
          <span class="material-symbols-outlined text-xl">close</span>
        </button>
        <div class="flex items-center gap-3 px-6 pt-6 pb-4">
          <div
            class="flex h-10 w-10 items-center justify-center rounded-xl bg-blue-600 text-lg font-black"
          >
            CH
          </div>
          <div>
            <p class="text-sm text-slate-400">Admin</p>
            <p class="text-base font-semibold">ClosetHub Panel</p>
          </div>
        </div>

        <nav class="mt-4 flex-1 px-3 space-y-1">
          <a
            href="/admin/dashboard"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm bg-slate-800 text-white"
          >
            <span class="material-symbols-outlined text-xl">space_dashboard</span>
            <span>Dashboard</span>
          </a>

          <a
            href="/admin"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-400 hover:bg-slate-800 hover:text-white"
          >
            <span class="material-symbols-outlined text-xl"> inventory_2 </span>
            <span>Sản phẩm</span>
          </a>

          <a
            href="/admin/orders"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-400 hover:bg-slate-800 hover:text-white"
          >
            <span class="material-symbols-outlined text-xl"> receipt_long </span>
            <span>Đơn hàng</span>
          </a>

          <a
            href="/admin/customers"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-400 hover:bg-slate-800 hover:text-white"
          >
            <span class="material-symbols-outlined text-xl"> group </span>
            <span>Khách hàng</span>
          </a>

          <a
            href="/admin/statistics"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-400 hover:bg-slate-800 hover:text-white"
          >
            <span class="material-symbols-outlined text-xl"> insights </span>
            <span>Thống kê</span>
          </a>

          <a
            href="/admin/banners"
            class="flex items-center gap-3 rounded-lg px-3 py-2 text-sm text-slate-400 hover:bg-slate-800 hover:text-white"
          >
            <span class="material-symbols-outlined text-xl"> image </span>
            <span>Banner</span>
          </a>
        </nav>

        <div class="mt-auto border-t border-slate-800 px-4 py-4">
          <button
            id="logoutBtn"
            class="flex w-full items-center justify-center gap-2 rounded-lg bg-slate-800 px-3 py-2 text-sm font-medium text-slate-100 hover:bg-slate-700"
          >
            <span class="material-symbols-outlined text-xl">logout</span>
            <span>Đăng xuất</span>
          </button>
        </div>
      </aside>

      <!-- Sidebar overlay for mobile -->
      <div
        id="sidebarOverlay"
        class="hidden fixed inset-0 bg-black/50 z-10 md:hidden"
      ></div>

      <!-- Main content -->
      <main class="flex-1 bg-slate-950 md:ml-64">
        <!-- Top bar -->
        <header
          class="flex items-center justify-between border-b border-slate-800 px-4 md:px-8 py-4 bg-slate-950/80 backdrop-blur sticky top-0 z-20"
        >
          <div>
            <p class="text-xs uppercase tracking-[0.2em] text-slate-500">
              Bảng quản trị
            </p>
            <h1 class="text-xl md:text-2xl font-semibold">Dashboard</h1>
            <p class="text-xs text-slate-500">
              Tổng quan hệ thống quản lý ClosetHub
            </p>
          </div>

          <div class="flex items-center gap-4">
            <div class="hidden sm:flex flex-col items-end">
              <p class="text-sm font-medium" id="currentUserName">Admin</p>
              <p class="text-xs text-slate-500" id="currentUserEmail"></p>
            </div>
            <div
              class="flex h-9 w-9 items-center justify-center rounded-full bg-slate-800 text-sm font-semibold"
            >
              A
            </div>
          </div>
        </header>

        <div class="px-4 md:px-8 py-6">
          <!-- Quick Stats -->
          <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
            <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 mb-1">Tổng sản phẩm</p>
                  <p class="text-2xl font-semibold text-blue-400" id="totalProducts">0</p>
                </div>
                <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-blue-500/10">
                  <span class="material-symbols-outlined text-blue-400 text-2xl">inventory_2</span>
                </div>
              </div>
            </div>

            <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 mb-1">Tổng đơn hàng</p>
                  <p class="text-2xl font-semibold text-emerald-400" id="totalOrders">0</p>
                </div>
                <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-emerald-500/10">
                  <span class="material-symbols-outlined text-emerald-400 text-2xl">receipt_long</span>
                </div>
              </div>
            </div>

            <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 mb-1">Tổng khách hàng</p>
                  <p class="text-2xl font-semibold text-amber-400" id="totalCustomers">0</p>
                </div>
                <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-amber-500/10">
                  <span class="material-symbols-outlined text-amber-400 text-2xl">group</span>
                </div>
              </div>
            </div>

            <div class="rounded-xl border border-slate-800 bg-slate-900/60 p-4">
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-xs text-slate-500 mb-1">Tổng doanh thu</p>
                  <p class="text-2xl font-semibold text-purple-400" id="totalRevenue">0 đ</p>
                </div>
                <div class="flex h-12 w-12 items-center justify-center rounded-lg bg-purple-500/10">
                  <span class="material-symbols-outlined text-purple-400 text-2xl">payments</span>
                </div>
              </div>
            </div>
          </section>

          <!-- Management Cards -->
          <section>
            <h2 class="text-sm font-semibold text-slate-300 mb-4">Quản lý hệ thống</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
              <!-- Quản lý sản phẩm -->
              <a
                href="/admin"
                class="dashboard-card rounded-xl border border-slate-800 bg-slate-900/60 p-6 cursor-pointer group"
              >
                <div class="flex flex-col items-center text-center">
                  <div class="flex h-16 w-16 items-center justify-center rounded-xl bg-blue-500/10 mb-4 group-hover:bg-blue-500/20 transition-colors">
                    <span class="material-symbols-outlined text-blue-400 text-4xl">inventory_2</span>
                  </div>
                  <h3 class="text-base font-semibold text-slate-100 mb-2">Quản lý sản phẩm</h3>
                  <p class="text-xs text-slate-500 mb-4">
                    Thêm, sửa, xóa và quản lý sản phẩm trong hệ thống
                  </p>
                  <div class="flex items-center gap-2 text-blue-400 text-sm font-medium">
                    <span>Xem chi tiết</span>
                    <span class="material-symbols-outlined text-base">arrow_forward</span>
                  </div>
                </div>
              </a>

              <!-- Quản lý đơn hàng -->
              <a
                href="/admin/orders"
                class="dashboard-card rounded-xl border border-slate-800 bg-slate-900/60 p-6 cursor-pointer group"
              >
                <div class="flex flex-col items-center text-center">
                  <div class="flex h-16 w-16 items-center justify-center rounded-xl bg-emerald-500/10 mb-4 group-hover:bg-emerald-500/20 transition-colors">
                    <span class="material-symbols-outlined text-emerald-400 text-4xl">receipt_long</span>
                  </div>
                  <h3 class="text-base font-semibold text-slate-100 mb-2">Quản lý đơn hàng</h3>
                  <p class="text-xs text-slate-500 mb-4">
                    Xem danh sách hóa đơn và chi tiết từng giao dịch
                  </p>
                  <div class="flex items-center gap-2 text-emerald-400 text-sm font-medium">
                    <span>Xem chi tiết</span>
                    <span class="material-symbols-outlined text-base">arrow_forward</span>
                  </div>
                </div>
              </a>

              <!-- Quản lý khách hàng -->
              <a
                href="/admin/customers"
                class="dashboard-card rounded-xl border border-slate-800 bg-slate-900/60 p-6 cursor-pointer group"
              >
                <div class="flex flex-col items-center text-center">
                  <div class="flex h-16 w-16 items-center justify-center rounded-xl bg-amber-500/10 mb-4 group-hover:bg-amber-500/20 transition-colors">
                    <span class="material-symbols-outlined text-amber-400 text-4xl">group</span>
                  </div>
                  <h3 class="text-base font-semibold text-slate-100 mb-2">Quản lý khách hàng</h3>
                  <p class="text-xs text-slate-500 mb-4">
                    Thêm, sửa, xóa và quản lý thông tin khách hàng
                  </p>
                  <div class="flex items-center gap-2 text-amber-400 text-sm font-medium">
                    <span>Xem chi tiết</span>
                    <span class="material-symbols-outlined text-base">arrow_forward</span>
                  </div>
                </div>
              </a>

              <!-- Thống kê báo cáo -->
              <a
                href="/admin/statistics"
                class="dashboard-card rounded-xl border border-slate-800 bg-slate-900/60 p-6 cursor-pointer group"
              >
                <div class="flex flex-col items-center text-center">
                  <div class="flex h-16 w-16 items-center justify-center rounded-xl bg-purple-500/10 mb-4 group-hover:bg-purple-500/20 transition-colors">
                    <span class="material-symbols-outlined text-purple-400 text-4xl">insights</span>
                  </div>
                  <h3 class="text-base font-semibold text-slate-100 mb-2">Thống kê báo cáo</h3>
                  <p class="text-xs text-slate-500 mb-4">
                    Xem doanh thu và top sản phẩm bán chạy
                  </p>
                  <div class="flex items-center gap-2 text-purple-400 text-sm font-medium">
                    <span>Xem chi tiết</span>
                    <span class="material-symbols-outlined text-base">arrow_forward</span>
                  </div>
                </div>
              </a>

              <!-- Quản lý banner -->
              <a
                href="/admin/banners"
                class="dashboard-card rounded-xl border border-slate-800 bg-slate-900/60 p-6 cursor-pointer group"
              >
                <div class="flex flex-col items-center text-center">
                  <div class="flex h-16 w-16 items-center justify-center rounded-xl bg-pink-500/10 mb-4 group-hover:bg-pink-500/20 transition-colors">
                    <span class="material-symbols-outlined text-pink-400 text-4xl">image</span>
                  </div>
                  <h3 class="text-base font-semibold text-slate-100 mb-2">Quản lý banner</h3>
                  <p class="text-xs text-slate-500 mb-4">
                    Thêm, sửa, xóa và quản lý banner khuyến mãi
                  </p>
                  <div class="flex items-center gap-2 text-pink-400 text-sm font-medium">
                    <span>Xem chi tiết</span>
                    <span class="material-symbols-outlined text-base">arrow_forward</span>
                  </div>
                </div>
              </a>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- Google Icons -->
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined"
      rel="stylesheet"
    />

    <script>
      const token = localStorage.getItem("auth_token");
      const user = JSON.parse(localStorage.getItem("auth_user") || "null");

      // Nếu chưa đăng nhập thì quay lại /login
      if (!token) {
        window.location.href = "/login";
      }

      // Hiển thị thông tin user
      if (user) {
        document.getElementById("currentUserName").textContent =
          user.fullname || user.name || "Admin";
        document.getElementById("currentUserEmail").textContent =
          user.email || "";
      }

      const logoutBtn = document.getElementById("logoutBtn");
      const mobileMenuBtn = document.getElementById("mobileMenuBtn");
      const sidebar = document.getElementById("sidebar");
      const sidebarOverlay = document.getElementById("sidebarOverlay");
      const closeSidebarBtn = document.getElementById("closeSidebarBtn");

      const totalProductsEl = document.getElementById("totalProducts");
      const totalOrdersEl = document.getElementById("totalOrders");
      const totalCustomersEl = document.getElementById("totalCustomers");
      const totalRevenueEl = document.getElementById("totalRevenue");

      // Mobile menu toggle
      function toggleMobileMenu() {
        if (sidebar && sidebarOverlay) {
          const isHidden = sidebar.classList.contains("hidden");
          if (isHidden) {
            sidebar.classList.remove("hidden");
            sidebar.classList.add("flex");
            sidebarOverlay.classList.remove("hidden");
          } else {
            sidebar.classList.add("hidden");
            sidebar.classList.remove("flex");
            sidebarOverlay.classList.add("hidden");
          }
        }
      }

      if (mobileMenuBtn) {
        mobileMenuBtn.addEventListener("click", toggleMobileMenu);
      }

      if (sidebarOverlay) {
        sidebarOverlay.addEventListener("click", toggleMobileMenu);
      }

      if (closeSidebarBtn) {
        closeSidebarBtn.addEventListener("click", toggleMobileMenu);
      }

      if (sidebar) {
        sidebar.querySelectorAll("nav a").forEach((link) => {
          link.addEventListener("click", () => {
            if (window.innerWidth < 768) {
              toggleMobileMenu();
            }
          });
        });
      }

      function formatCurrency(v) {
        const num = Number(v) || 0;
        return num.toLocaleString("vi-VN", {
          style: "currency",
          currency: "VND",
          maximumFractionDigits: 0,
        });
      }

      async function loadDashboardStats() {
        try {
          // Load products count
          try {
            const productsRes = await fetch("/api/product/list/admin", {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });
            const productsData = await productsRes.json();
            if (Array.isArray(productsData.data)) {
              totalProductsEl.textContent = productsData.data.length.toLocaleString("vi-VN");
            }
          } catch (err) {
            console.error("Load products error", err);
          }

          // Load orders count and revenue
          try {
            const ordersRes = await fetch("/api/order/list/admin", {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });
            const ordersData = await ordersRes.json();
            if (Array.isArray(ordersData.data)) {
              totalOrdersEl.textContent = ordersData.data.length.toLocaleString("vi-VN");
              const totalRevenue = ordersData.data.reduce(
                (sum, order) => sum + (order.total_amount || 0),
                0
              );
              totalRevenueEl.textContent = formatCurrency(totalRevenue);
            }
          } catch (err) {
            console.error("Load orders error", err);
          }

          // Load customers count
          try {
            const customersRes = await fetch("/api/customer/list", {
              headers: {
                Authorization: `Bearer ${token}`,
              },
            });
            const customersData = await customersRes.json();
            if (Array.isArray(customersData.data)) {
              totalCustomersEl.textContent = customersData.data.length.toLocaleString("vi-VN");
            }
          } catch (err) {
            console.error("Load customers error", err);
          }
        } catch (err) {
          console.error("Load dashboard stats error", err);
        }
      }

      logoutBtn.addEventListener("click", () => {
        localStorage.removeItem("auth_token");
        localStorage.removeItem("auth_user");
        window.location.href = "/login";
      });

      // Khởi chạy
      loadDashboardStats();
    </script>
  </body>
</html>



